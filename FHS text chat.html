<!doctype html><html lang="it"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>P2P Chat v0.5f — FHS</title><style>:root{--bg:#000;--bar:#0b1220;--line:#1f2937;--txt:#e5e7eb;--bubble-me:#d4f7c8;--bubble-me-text:#0f2e13;--bubble-peer:#ffffff;--bubble-peer-text:#0b1020;--bubble-old:#d9d9d9;--inset-top:16.14%;--inset-right:16.56%;--inset-bottom:16.35%;--inset-left:16.35%}*{box-sizing:border-box}html,body{height:100%}body{margin:0;background:var(--bg);display:grid;place-items:center;padding:1rem;color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}#app{width:512px;height:800px;background:#000;border-radius:12px;overflow:hidden;position:relative;border:1px solid #111}.screen{position:absolute;inset:0;display:none}.screen.active{display:grid}#setup{grid-template-rows:auto 1fr auto}#setup header{padding:.7rem .9rem;background:var(--bar);border-bottom:1px solid var(--line);display:flex;justify-content:space-between;align-items:center}#setup main{display:grid;place-items:center;padding:1rem}#setup .panel{width:92%;max-width:480px;background:#0b0f1a;border:1px solid #0f172a;border-radius:12px;padding:1rem}.row{display:flex;gap:.6rem;margin:.2rem 0}.col{flex:1}label{display:block;font-size:.9rem;color:#94a3b8;margin:.35rem 0 .2rem}input[type=text],select{width:100%;padding:.6rem .7rem;border:1px solid #223;background:#0b0f1a;color:#fff;border-radius:8px}.radio{display:flex;gap:.8rem;align-items:center;margin:.6rem 0}.radio label{display:flex;align-items:center;gap:.35rem;cursor:pointer;margin:0}.hint{color:#9ca3af;font-size:.85rem;margin-top:.4rem}.btn{padding:.55rem .9rem;border-radius:10px;cursor:pointer;border:1px solid #334155;background:#0f172a;color:#fff;transition:background-color .2s,border-color .2s,color .2s,opacity .2s}.btn.primary{background:#22c55e;border-color:#16a34a;color:#052e14;font-weight:700}.btn:disabled{opacity:1;cursor:not-allowed}.btn.primary:disabled{background:#6b7280;border-color:#4b5563;color:#111827}.pickWrap{display:flex;align-items:center;gap:.6rem}#avatarWrap{display:none}.avatarBox{width:72px;height:72px;border:1px solid #334155;border-radius:12px;background:#0b0f1a;display:grid;place-items:center;cursor:pointer;overflow:hidden}.avatarBox img{width:100%;height:100%;object-fit:cover}#main{grid-template-rows:auto auto auto auto 1fr auto}header.bar{background:var(--bar);border-bottom:1px solid var(--line);padding:.5rem .7rem;display:flex;align-items:center;justify-content:space-between}.status{font-size:.95rem;color:#cbd5e1;font-weight:700}.pill{display:inline-block;padding:.12rem .45rem;border-radius:999px;background:#1f2937;font-size:.72rem;margin-left:.35rem}.controls{display:flex;gap:.35rem}.controls .btn{background:#0f172a;border:1px solid #334155;color:#e5e7eb}.controls .danger{background:#7f1d1d;border-color:#fecaca;color:#fee2e2}#banner{display:none;padding:.45rem .7rem;font-weight:600}.banner-warn{background:#3b2f14;color:#fde68a;border-bottom:1px solid #a16207}.banner-err{background:#3a1b1b;color:#fecaca;border-bottom:1px solid #b91c1c}#info{background:#0b1220;border-bottom:1px solid var(--line);padding:.35rem .6rem;color:#9ca3af}#frameWrap{position:relative;width:100%;aspect-ratio:1/1;background:transparent url("https://massimagnus.github.io/FHS-chat/cornice.png?v=0.5") center/contain no-repeat}#frameWrap.clickable{cursor:pointer}#specchio{position:absolute;inset:var(--inset-top) var(--inset-right) var(--inset-bottom) var(--inset-left);background:#10b981 center/cover no-repeat;border-radius:2px}#feedbackDock{position:absolute;left:8px;right:8px;bottom:64px;display:none;align-items:center;justify-content:center;gap:.5rem;padding:.4rem .6rem;background:#0b1220;border:1px solid #334155;border-radius:10px;z-index:70}#fbControls{display:flex;align-items:center;gap:.45rem}#fbControls select{background:#0f172a;color:#e5e7eb;border:1px solid #334155;border-radius:8px;padding:.35rem .5rem}.swatches{display:flex;gap:.25rem}.swatch{width:18px;height:18px;border-radius:50%;border:1px solid #ffffff33;cursor:pointer}.swatch.sel{outline:2px solid #fff}#fbSend{background:#22c55e;border:1px solid #16a34a;color:#052e14;border-radius:8px;padding:.35rem .6rem;font-weight:700}#serverPop{display:none;padding:.35rem .6rem;border-radius:10px;background:#111827;color:#e5e7eb;border-left:6px solid #8b5cf6;font-weight:700}#names{display:grid;grid-template-columns:1fr 1fr;padding:.35rem .6rem .1rem;font-weight:800;color:#cbd5e1;font-size:.95rem}#names div{text-align:center}#chat{display:grid;grid-template-rows:auto 1fr;padding:.2rem .6rem .4rem}#grid{display:grid;grid-template-columns:1fr 1fr;gap:.35rem;overflow:hidden}.colList{display:flex;flex-direction:column;gap:.3rem;overflow:hidden}.colList.client{align-items:flex-end}.colList.server{align-items:flex-start}.colList.client .bubble{text-align:right}.colList.server .bubble{text-align:left}.bubble{display:inline-block;max-width:90%;padding:.5rem .7rem;border-radius:.9rem;box-shadow:0 1px 0 rgba(0,0,0,.35);white-space:pre-wrap;line-height:1.25;transition:filter .25s,opacity .25s,transform .25s;overflow:hidden;word-break:break-word;overflow-wrap:anywhere}.colList.server .bubble.last{background:var(--bubble-me);color:var(--bubble-me-text);border:1px solid #a7e3a0;font-size:1rem;transform:scale(1)}.colList.client .bubble.last{background:var(--bubble-peer);color:var(--bubble-peer-text);border:1px solid #e5e7eb;font-size:1rem;transform:scale(1)}.bubble:not(.last){background:var(--bubble-old);color:#1b1b1b;border:1px solid #c9c9c9;opacity:.78;filter:saturate(.7);font-size:.84rem;transform:scale(.95)}.bubble.custom{border:1px solid rgba(0,0,0,.18)!important}.composer{position:sticky;bottom:0;z-index:60;background:var(--bar);border-top:1px solid var(--line);padding:.5rem .6rem;display:flex;gap:.45rem;align-items:center}#text{flex:1;padding:.7rem .9rem;border:1px solid #475569;border-radius:999px;background:#0f172a;color:#e5e7eb;caret-color:#e5e7eb;font-size:1.05rem}#text::placeholder{color:#94a3b8}#sendBtn{display:none}#history{position:absolute;inset:0;background:rgba(0,0,0,.55);display:none;align-items:center;justify-content:center}#history .card{width:86%;max-width:480px;max-height:70%;background:#0b0f1a;border:1px solid #334155;border-radius:12px;display:flex;flex-direction:column;color:#e5e7eb}#history header{padding:.5rem .7rem;font-weight:700;border-bottom:1px solid #334155;display:flex;justify-content:space-between;align-items:center;gap:.5rem}#history main{padding:.6rem .7rem;overflow:auto}.hrow{display:flex;gap:.5rem;margin:.15rem 0}.hwho{width:80px;font-weight:700;color:#9ca3af}.htext{flex:1}#jsErr{position:absolute;left:12px;right:12px;bottom:12px;background:#3a1b1b;color:#fee2e2;padding:.5rem .75rem;border:1px solid #b91c1c;border-radius:8px;display:none;font-weight:700}</style></head><body><div id="app"><section id="setup" class="screen active"><header><strong>Impostazioni</strong><span style="color:#9ca3af">P2P WebRTC — v0.5f</span></header><main><div class="panel"><div class="row"><div class="col"><label for="nickMe">Il tuo nickname</label><input id="nickMe" type="text" placeholder="Es. Marco" maxlength="24"></div><div class="col" id="roomCol"><label id="roomLabel" for="room">Codice stanza (solo CLIENT)</label><input id="room" type="text" placeholder="Es. P2P-AB123" maxlength="48"></div></div><div class="row"><div class="col"><label for="genderSel">Genere</label><select id="genderSel"><option value="">Seleziona…</option><option>uomo</option><option>donna</option><option>transgender</option><option>uomo effeminato</option><option>donna mascolina</option><option>indeterminato</option></select></div><div class="col"><label for="ageSel">Età apparente</label><select id="ageSel"><option value="">Seleziona…</option><option>adolescente</option><option>giovane</option><option>adulta</option><option>matura</option><option>anziana</option><option>vecchia</option></select></div></div><div class="row"><div class="col"><label>Icona personaggio</label><div class="pickWrap" id="avatarWrap"><div class="avatarBox" id="avatarBox" title="Clicca per cambiare"><img id="avatarImg" alt="avatar" src=""></div></div></div></div><div class="radio"><label><input type="radio" name="role" value="server" checked> SERVER (crea)</label><label><input type="radio" name="role" value="client"> CLIENT (entra)</label></div><div class="row"><button id="btnStart" class="btn primary" style="flex:1" disabled title="Completa: Nickname, Genere, Età apparente">Avvia</button><button id="btnPaste" class="btn" title="Incolla codice dagli appunti">Incolla codice</button></div><div class="hint">SERVER: dai un nome alla stanza (opzionale). CLIENT: inserisci il codice stanza. L’icona appare dopo aver completato nick+genere+età.</div></div></main><footer style="padding:.65rem .9rem;color:#9ca3af;border-top:1px solid #1f2937">Nessun dato su server: il flusso viaggia P2P tra i browser.</footer></section><section id="main" class="screen"><header class="bar"><div class="status" id="status">offline</div><div class="controls"><span id="pillSSE" class="pill">SSE</span><span class="pill">v0.5f</span><button id="btnHistory" class="btn">STORIA</button><button id="btnQuit" class="btn danger">ESCI</button></div></header><div id="banner" role="status"></div><div id="info">Codice: <strong id="codeBox">—</strong></div><div id="frameWrap"></div><div id="feedbackDock"><div id="fbControls"><span style="color:#9ca3af">Feedback:</span><select id="fbSelect"><option>Vergogna</option><option>Inguardabile!</option><option>No grazie!</option><option>Noia</option><option>Indifferente</option><option>Rilassante</option><option>Piacevole</option><option>In estasi!</option><option>Da brividi!</option><option>Sconvolgente!</option><option>Fastidio</option><option>Paura!</option><option>Aiuto!</option></select><div class="swatches" id="fbSwatches"></div><button id="fbSend">Invia</button></div><div id="serverPop">reazione: …</div></div><div id="names"><div id="nameClient">CLIENT</div><div id="nameServer">SERVER</div></div><div id="chat"><div id="grid"><div id="colClient" class="colList client"></div><div id="colServer" class="colList server"></div></div></div><div class="composer"><input id="text" type="text" placeholder="Scrivi un messaggio…"><button id="sendBtn" disabled>Invia</button></div></section><div id="history"><div class="card"><header><span>Storia conversazione</span><span><button id="btnCopyHist" class="btn">Copia log</button><button id="btnCloseHist" class="btn">Chiudi</button></span></header><main id="histBody"></main></div></div><div id="jsErr"></div><input id="fileSpec" type="file" accept="image/*" style="display:none"></div><script>const APP_VERSION="0.5f";const FRAME_SRC="https://massimagnus.github.io/FHS-chat/cornice.png?v=0.5";const FB_COLORS=["rgb(180,180,180)","rgb(190,160,200)","rgb(205,130,215)","rgb(220,100,230)","rgb(235,70,242)","rgb(245,35,250)","rgb(255,0,255)"];const IMG_BASE="images/";function setScreen(e){var t=document.getElementById("setup"),n=document.getElementById("main");t&&t.classList.remove("active"),n&&n.classList.remove("active");var a=document.getElementById(e);a&&a.classList.add("active")}(()=>{"use strict";var e=[{urls:"stun:stun.l.google.com:19302"}],t=[],n=null,a=null,o=null,i=!1,r=null,l=null,s="0",c=null,d=crypto.getRandomValues(new Uint32Array(1))[0].toString(16),u=[],m=!1,v=!1,f=!1,p=1e3,h=1e4,g=!1,y=!1,b=null,S=null,w="Io",E="Peer",L=[],C=!0,k=null,x=!1,T=3,A={gender:"",age:""},B=null,M=!1,O=IMG_BASE+"cl01.png",D=1;function N(e){return document.getElementById(e)}function I(e,t){var n=N("banner");n&&(n.textContent=e,n.className="err"===t?"banner-err":"banner-warn",n.style.display="block")}function R(){var e=N("banner");e&&(e.style.display="none",e.textContent="",e.className="")}function q(e){var t=N("status");t&&(e&&B?t.textContent="Stanza: "+B:t.textContent="offline")}function _(e){return"P2P-"+Math.random().toString(36).slice(2,7).toUpperCase()}function H(e){return"p2pchat-"+e}function P(){return l+"-"+s}function z(){var e=(new URL(location.href),new URL(location.href));return e.origin+e.pathname}function j(e){var t=new URL(z());return t.searchParams.set("code",e),t.searchParams.set("join","1"),t.searchParams.set("v",APP_VERSION),t.toString()}function F(){N("nameClient").textContent="CLIENT: "+(i?E:w),N("nameServer").textContent="SERVER: "+(i?w:E)}function G(e,t){t=t||3;for(;e.children.length>t;)e.removeChild(e.lastChild)}function J(e,t){var n="client"===e?N("colClient"):N("colServer");if(n){var a=n.querySelector(".bubble.last");a&&a.classList.remove("last");var o=document.createElement("div");o.className="bubble last",o.textContent=t,n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o),G(n,3),C&&L.push({side:e,text:t})}}function K(e,t,n){var a="client"===e?N("colClient"):N("colServer");if(a){var o=a.querySelector(".bubble.last");o&&o.classList.remove("last");var i=document.createElement("div");i.className="bubble last custom",i.textContent=t,n&&(i.style.background=n),a.firstChild?a.insertBefore(i,a.firstChild):a.appendChild(i),G(a,3),C&&L.push({side:e,text:t})}}function Q(){var e=N("histBody");if(e){e.innerHTML="";for(var t=0;t<L.length;t++){var n=L[t],a=document.createElement("div");a.className="hrow";var o=document.createElement("div");o.className="hwho",o.textContent=n.side.toUpperCase();var i=document.createElement("div");i.className="htext",i.textContent=n.text,a.appendChild(o),a.appendChild(i),e.appendChild(a)}}}function U(e){return(e<10?"0":"")+e}function V(){var e=document.querySelector('input[name="role"]:checked'),t=!e||"server"===e.value,n=N("genderSel").value.toLowerCase(),a=[];for(var o=1;o<=16;o++)if(t)"uomo"!==n&&"uomo effeminato"!==n?"donna"!==n&&"donna mascolina"!==n?a.push(o):o%2==1&&a.push(o):o%2==0&&a.push(o);else a.push(o);return a}function W(){var e=document.querySelector('input[name="role"]:checked');return!e||"server"===e.value?"sv":"cl"}function X(){var e=V();-1===e.indexOf(D)&&(D=e[0]||1),ee()}function Y(){var e=V();e.length||(D=1);var t=e.indexOf(D);D=-1===t?e[0]:e[(t+1)%e.length],ee()}function Z(){return IMG_BASE+W()+U(D)+".png"}function ee(){var e=Z();O=e;var t=N("avatarImg");t&&(t.src=e)}function te(){var e=N("frameWrap");e&&(e.classList.toggle("clickable",i),N("specchio")||(t=document.createElement("div"),t.id="specchio",e.appendChild(t)));var t}function ne(e){te();var t=N("specchio");t&&(t.style.backgroundImage=e?'url("'+e+'")':"none")}function ae(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=n,a.readAsDataURL(e)})}function oe(e){if(!r)return Promise.resolve();var t=JSON.stringify(Object.assign({},e,{from:d}));return fetch("https://ntfy.sh/"+c,{method:"POST",headers:{"Content-Type":"text/plain;charset=UTF-8"},body:t}).catch(function(){})}function ie(e){o&&(o.close&&o.close()),o=new EventSource("https://ntfy.sh/"+e+"/sse"),o.onopen=function(){g=!0,p=1e3;var e=N("pillSSE");e&&(e.style.background="#14532d",e.style.border="1px solid #16a34a"),R()},o.onerror=function(){g&&I("Signaling disconnesso. Riconnessione…","warn"),g=!1;var e=N("pillSSE");e&&(e.style.background="#78350f",e.style.border="1px solid #fbbf24");try{o.close()}catch(e){}setTimeout(function(){ie(e)},p),p=Math.min(h,Math.round(1.8*p))},o.onmessage=function(e){try{var t=JSON.parse(e.data);if(!t||"string"!=typeof t.message)return;var n=JSON.parse(t.message);n&&n.from!==d&&se(n)}catch(e){}}}function re(){u=[],m=!1,v=!1;S&&(clearTimeout(S),S=null),(n=new RTCPeerConnection({iceServers:e.concat(t)})).oniceconnectionstatechange=function(){var e=n.iceConnectionState;"failed"===e?(I("Connessione peer fallita. Riprovo…","err"),de("ice-failed")):"disconnected"===e&&(I("Peer disconnesso. Attendo…","warn"),q(!1),S||(S=setTimeout(function(){de("ice-disconnected")},2500)))},n.onconnectionstatechange=function(){var e=n.connectionState;"connected"===e?(q(!0),R(),y=!1,N("sendBtn").disabled=!1,i&&(k=O,le({kind:"spec",dataUrl:k})),le({kind:"avatar",url:O})):"failed"===e?(q(!1),N("sendBtn").disabled=!0,de("conn-failed")):"disconnected"===e&&(q(!1),N("sendBtn").disabled=!0)},i?(a=n.createDataChannel("chat"),seu(a)):n.ondatachannel=function(e){a=e.channel,seu(a)},n.onicecandidate=function(e){e&&e.candidate&&oe({t:"candidate",candidate:e.candidate})}}function seu(e){e.onopen=function(){},e.onclose=function(){N("sendBtn").disabled=!0,I("Canale dati chiuso. Riconnessione…","err"),b&&clearTimeout(b),b=setTimeout(function(){de("dc-closed")},600)},e.onmessage=function(e){ce(e.data)}}function le(e){e=e||{},a&&"open"===a.readyState&&function(e){try{a.send(JSON.stringify(Object.assign({t:"ctrl"},e)))}catch(e){}}(),"quit"===e.kind&&oe({t:"quit"})}function ce(e){try{var t=JSON.parse(e);"txt"===t.t?J(i?"client":"server",t.text):"ctrl"===t.t&&("spec"===t.kind&&t.dataUrl?(ne(t.dataUrl),i||(x=!0,he(!0))):"spec-clear"===t.kind?(ne(null),i||(x=!1,he(!1))):"fb"===t.kind&&i?(pe(t.val,t.color||FB_COLORS[3]),K("client",t.val,t.color||FB_COLORS[3])):"room-name"===t.kind&&!i?(B=t.name||B,B&&!M&&(L.push({side:"system",text:"Ingresso in "+B}),M=!0,q(n&&"connected"===n.connectionState))):"avatar"===t.kind&&i&&t.url&&ne(t.url))}catch(t){J(i?"client":"server",e)}}function de(e){if(!y)if(y=!0,i){var t=(new Date).toString(36)+"-"+Math.random().toString(36).slice(2,6);oe({t:"switch",gen:t,why:e}).then(function(){setTimeout(function(){ue(t)},120)}).catch(function(){setTimeout(function(){ue(t)},200)})}else oe({t:"need-switch",why:e})}function ue(e){he(!1),fe(),s=e,c=P(),ie(c),re(),oe({t:"hello",nick:w,role:i?"server":"client"}),i&&(oe({t:"state",spec:k}),B&&le({kind:"room-name",name:B}),k&&le({kind:"spec",dataUrl:k})),R()}function fe(){try{a&&(a.onopen=null,a.onclose=null,a.onmessage=null,a.close())}catch(e){}try{n&&(n.oniceconnectionstatechange=null,n.onconnectionstatechange=null,n.ondatachannel=null,n.close())}catch(e){}a=null,n=null,u=[],m=!1,v=!1}function me(){C=!1;try{o&&o.close()}catch(e){}fe(),o=null,c=null,l=null,r=null,N("codeBox").textContent="—",ne(null),N("colClient").innerHTML="",N("colServer").innerHTML="",L=[],x=!1,he(!1),q(!1),setScreen("setup"),B=null,M=!1,k=null}function he(e){var t=N("feedbackDock"),n=N("fbControls"),a=N("serverPop");i?(n.style.display="none",e?(t.style.display="flex",a.style.display="block"):(a.style.display="none",x||(t.style.display="none"))):(a.style.display="none",t.style.display=e?"flex":"none",n.style.display=e?"flex":"none")}function pe(e,t){var n=N("feedbackDock"),a=N("serverPop");a.textContent="reazione: "+e,a.style.borderLeftColor=t||FB_COLORS[3],n.style.display="flex",a.style.display="block",clearTimeout(a._tm),a._tm=setTimeout(function(){a.style.display="none",n.style.display="none"},6e3)}function ge(e){F(),te(),ye(),he(!1),e&&(N("colClient").innerHTML="",N("colServer").innerHTML="",ne(null),L=[],B&&!M&&(L.push({side:"system",text:"Ingresso in "+B}),M=!0))}function ye(){var e=document.querySelector('input[name="role"]:checked'),t=!e||"server"===e.value,n=N("room"),a=N("btnPaste"),o=N("roomCol"),r=N("roomLabel");t?(r.textContent="Dai un nome alla stanza",n.disabled=!1,n.placeholder="Es. Sala di Marco",a.style.display="none",o.style.opacity="1"):(
r.textContent="Codice stanza (solo CLIENT)",n.disabled=!1,n.placeholder="Es. P2P-AB123",a.style.display="",o.style.opacity="1"),ee()}function be(){var e=(N("nickMe").value||"").trim(),t=N("genderSel").value||"",n=N("ageSel").value||"",a=document.querySelector('input[name="role"]:checked'),o=!a||"server"===a.value,i=(N("room").value||"").trim(),r=[];e||r.push("Nickname"),t||r.push("Genere"),n||r.push("Età apparente"),o||i||r.push("Codice stanza");var l=N("btnStart"),s=r.length>0;l.disabled=s,l.title=s?"Completa: "+r.join(", "):"Pronto a connettersi",-1===l.className.indexOf("primary")&&(l.className+=" primary"),we()}function we(){var e=(N("nickMe").value||"").trim(),t=(N("genderSel").value||"").trim(),n=(N("ageSel").value||"").trim();if(e&&t&&n){var a=V();D=a[0]||1,ee(),N("avatarWrap").style.display="flex"}else N("avatarWrap").style.display="none"}function Se(){C=!0,re(),c=P(),ie(c),oe({t:"hello",nick:w,role:i?"server":"client",gender:A.gender||""}),i&&B&&le({kind:"room-name",name:B})}function xe(){var e=N("text").value;if(e){var t=i?"server":"client";!function(e){a&&"open"===a.readyState&&function(e){try{a.send(JSON.stringify({t:"txt",text:e}))}catch(e){}}(e)}(e),J(t,e),N("text").value=""}}document.addEventListener("click",function(e){var t=e.target&&e.target.id?e.target.id:"";"btnPaste"===t?navigator.clipboard&&navigator.clipboard.readText&&navigator.clipboard.readText().then(function(e){N("room").value=(e||"").trim(),be()}):"btnStart"===t?(w=(N("nickMe").value||"Io").trim(),A.gender=N("genderSel").value,A.age=N("ageSel").value,i=!(document.querySelector('input[name="role"]:checked')&&"client"===document.querySelector('input[name="role"]:checked').value),X(),i?(r=_(),l=H(r),s="0",c=P(),N("codeBox").textContent=r,B=(N("room").value||"").trim()||"Stanza di "+w,setScreen("main"),ge(!0),Se(),navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(j(r)).catch(function(){})):(function(){var e=(N("room").value||"").trim().toUpperCase();if(!e)return void alert("Inserisci un codice stanza");r=e,l=H(r),s="0",c=P(),N("codeBox").textContent=r,setScreen("main"),ge(!0),Se()}())):"btnHistory"===t?(
Q(),N("history").style.dFisplay="flex"):"btnCloseHist"===t?N("history").style.display="none":"btnCopyHist"===t?function(){for(var e=[],t=0;t<L.length;t++){var n=L[t];"server"===n.side?e.push("SERVER: "+n.text):"client"===n.side?e.push("CLIENT: "+n.text):e.push(n.text)}var a=e.join("\n");navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(a).then(function(){alert("Log copiato negli appunti.")}).catch(function(){!function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.style.position="fixed",t.style.left="-9999px",t.select();try{document.execCommand("copy"),alert("Log copiato negli appunti.")}catch(e){alert("Impossibile copiare automaticamente.")}document.body.removeChild(t)}(a)}):!function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.style.position="fixed",t.style.left="-9999px",t.select();try{document.execCommand("copy"),alert("Log copiato negli appunti.")}catch(e){alert("Impossibile copiare automaticamente.")}document.body.removeChild(t)}(a)}():"btnQuit"===t?(le({kind:"quit"}),me()):"frameWrap"!==t&&"specchio"!==t||i&&N("fileSpec").click()}),document.addEventListener("change",function(e){var t=e.target&&e.target.id?e.target.id:"";"fileSpec"===t&&i?function(e){var t=e.target.files&&e.target.files[0];t&&ae(t).then(function(t){ne(t),k=t,le({kind:"spec",dataUrl:t}),e.target.value="",x=!1})}(e):e.target&&"role"===e.target.name?(ye(),be(),X()):"genderSel"!==t&&"ageSel"!==t||(be(),X())}),document.addEventListener("input",function(e){var t=e.target&&e.target.id?e.target.id:"";"nickMe"!==t&&"room"!==t||be()}),document.addEventListener("keyup",function(e){var t=e.target&&e.target.id?e.target.id:"";"nickMe"!==t&&"room"!==t||be()}),document.addEventListener("keydown",function(e){"Enter"===e.key&&e.target&&"text"===e.target.id&&(e.preventDefault(),xe())});!function(){var e=N("fbSwatches");if(e){e.innerHTML="";for(var t=function(t){var n=FB_COLORS[t],a=document.createElement("div");a.className="swatch"+(t===T?" sel":""),a.style.background=n,a.title="Intensità "+(t+1)+"/7",a.onclick=function(){T=t,function(){var e=N("fbSwatches");if(e){e.innerHTML="";for(var t=0;t<FB_COLORS.length;t++)!function(t){var n=FB_COLORS[t],a=document.createElement("div");a.className="swatch"+(t===T?" sel":""),a.style.background=n,a.title="Intensità "+(t+1)+"/7",a.onclick=function(){T=t,arguments.callee&&arguments.callee()},e.appendChild(a)}(t)}}()},e.appendChild(a)},n=0;n<FB_COLORS.length;n++)t(n)}}(),N("avatarBox").addEventListener("click",Y),window.addEventListener("offline",function(){I("Sei offline. Verifica la connessione.","warn"),q(!1)}),window.addEventListener("online",function(){R(),c&&ie(c)});var ve=new URL(location.href),fe2=(ve.searchParams.get("code")||"").trim().toUpperCase(),me2="1"===ve.searchParams.get("join");fe2&&(N("room").value=fe2,me2&&(document.querySelector('input[name="role"][value="client"]').checked=!0)),ye(),be(),X()})();</script><script>document.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("frameWrap");if(e&&!document.getElementById("specchio")){e.style.backgroundImage='url("'+("undefined"!=typeof FRAME_SRC?FRAME_SRC:"")+'")';var t=document.createElement("div");t.id="specchio",e.appendChild(t)}});</script></div></body></html>

